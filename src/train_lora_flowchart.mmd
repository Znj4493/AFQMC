---
id: 6d8cf646-4496-4f9a-b4a1-003a42867d24
// [MermaidChart: 6d8cf646-4496-4f9a-b4a1-003a42867d24]
---
flowchart TD
    A[加载模型 + LoRA] --> B[加载训练数据]
    B --> C[划分训练集/验证集]
    C --> D["Tokenize + 构建 DataLoader"]
    D --> E[配置优化器 + 学习率调度器]
    E --> F[训练循环开始]
    F --> G["前向传播: 计算 loss"]
    G --> H["反向传播: 计算梯度"]
    H --> I{梯度累积够了?}
    I -- 否 --> F
    I -- 是 --> J[更新参数 + 清零梯度]
    J --> K{到评估步数?}
    K -- 否 --> F
    K -- 是 --> L[验证集评估]
    L --> M{F1 提升?}
    M -- 是 --> N[保存最佳模型]
    M -- 否 --> O{早停?}
    N --> F
    O -- 否 --> F
    O -- 是 --> P[训练结束]